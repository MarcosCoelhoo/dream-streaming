(()=>{"use strict";class t{constructor(t,i){this.objMidiaInfo=i,this.idSection=t,console.log(t),this.parentMidiaList=document.querySelector(`${t} .movie-list`)}buildSection(){const{rate:t,popularity:i,year:e,image:a,id:s,type:n,title:c}=this.objMidiaInfo,r=c.replace(/[\s\W]+/g,"-").toLowerCase();if(a){const c=document.createElement("li");c.innerHTML=`\n    <a href='${r}.html' data-id='${s}' data-type='${n}'>\n  <div class="popular-image movie-image">\n  <img src="https://image.tmdb.org/t/p/w780${a}" alt="">\n</div>\n<div class="movie-content">\n  <div class="movie-rate">\n    <div class="rate">\n      ${t}\n      <img src="./assets/icons/star.svg" alt="icon star rate" width="13px" height="13px">\n    </div>\n  </div>\n\n  <div class="movie-info">\n    <div class="info-year">\n      ${e}\n    </div>\n    <div class="info-views">\n      <img src="./assets/icons/eye.svg" alt="" width="16px" height="16px">\n      <p>${i}</p>\n    </div>\n  </div>\n</div>\n</a>\n  `,this.parentMidiaList.appendChild(c)}}init(){return this.buildSection(),function(t){const i=document.querySelectorAll(`${t} [data-control]`),e=document.querySelectorAll(`${t} .movie-list li`),a=e.length;let s=0;function n({target:t}){"left"===t.dataset.control?s-=2:s+=2,s>=a&&(s=0),s<0&&(s=a-1),e.forEach((t=>t.classList.remove(".active"))),e[s].scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"}),e[s].classList.add("active")}e[s].classList.add("active"),i.forEach((t=>{t.addEventListener("click",n)}))}(this.idSection),this}}class i{constructor(t,i){this.idSectionSimilar=i,this.sectionParent=document.querySelector(`${i} .movie-list`),this.objMidia=t}async getSimilarMidias(i,e){this.sectionParent.children.length&&[...this.sectionParent.children].forEach((t=>{this.sectionParent.removeChild(t)})),(await(await fetch(`https://api.themoviedb.org/3/${i}/${e}/similar?api_key=25ea17bf3ab54060fea05921b6061c3c&language=en&region=BR`)).json()).results.forEach((a=>{const s={rate:a.vote_average.toFixed(1),year:a.release_date?a.release_date.slice(0,4):a.first_air_date.slice(0,4),popularity:a.popularity,image:a.poster_path,type:i,id:e,title:"movie"===i?a.title:a.name};new t(this.idSectionSimilar,s).init()}))}buildMidiaInfo(){const{rate:t,year:i,backdrop:e,type:a,title:s,genres:n,time:c,id:r,overview:o}=this.objMidia,d=document.querySelector(".section-midia .section-content");if(e){d.innerHTML=`\n      <div class="midia-image">\n      <div class="filter-image"></div>\n      <img src="https://image.tmdb.org/t/p/w780${e}" alt="">\n    </div>\n    <div class="midia-info">\n      <div class="midia-data">\n        <p class="data year">${i}</p>\n        <p class="data time">${c}</p>\n        <div class="rate data year">\n          <p>${t}</p>\n          <img src="./assets/icons/star.svg" alt="icon star rate" width="13px" height="13px">\n        </div>\n      </div>\n    \n      <h1 class="midia-title">${s}</h1>\n    \n      <ul class="midia-genres">\n           \n      </ul>\n    \n      <div class="midia-description">\n        <h2 class="section-title">Description</h2>\n    \n        <p class="description-text">${o}</p>\n      </div>\n    </div>\n      `;const l=document.querySelector(".section-midia .midia-genres");n.forEach((t=>{l.innerHTML+=`<li><p>${t.name}</p></li>`})),document.querySelector(".section-midia").classList.add("active"),document.title=`Dream | ${s}`,this.getSimilarMidias(a,r)}}static addEventButtonBack(){document.querySelector(".back").addEventListener("click",(t=>{t.preventDefault();const i=document.querySelector(".section-midia");document.title="Dream",i.classList.remove("active")}))}init(){return this.buildMidiaInfo(),this.constructor.addEventButtonBack(),this}}class e{constructor(t,i){this.midiaLink=t,this.idSectionSimilar=i,this.getInfoMidia=this.getInfoMidia.bind(this)}async getDataMidia(t,e){const a=await(await fetch(`https://api.themoviedb.org/3/${e}/${t}?api_key=25ea17bf3ab54060fea05921b6061c3c&language=pt-BR&region=BR`)).json(),s={rate:a.vote_average.toFixed(1),year:a.release_date?a.release_date.slice(0,4):a.first_air_date.slice(0,4),backdrop:a.backdrop_path,type:e,title:a.title?a.title:a.name,genres:a.genres,time:"movie"===e?`${a.runtime}min`:`${a.number_of_seasons} season(s)`,id:t,overview:a.overview};new i(s,this.idSectionSimilar).init()}getInfoMidia(t){t.preventDefault(),window.scrollTo({top:0,behavior:"smooth"});const{target:i}=t,e=i.dataset.id,a=i.dataset.type;this.getDataMidia(e,a)}addEventMidia(){this.midiaLink.addEventListener("click",this.getInfoMidia)}init(){this.addEventMidia()}}class a{constructor(t,i,e,a,s,n){this.baseUrl=t,this.apiKey=i,this.category=a,this.imageUrl=e,this.idSection=s,this.typeMidiaFetch=n}getDataMidia(t){return{rate:t.vote_average.toFixed(1),popularity:t.popularity,year:t.release_date?t.release_date.slice(0,4):t.first_air_date.slice(0,4),image:`${this.imageUrl}${t.poster_path}`,backdrop:`${this.imageUrl}${t.backdrop_path}`,id:t.id,type:this.typeMidiaFetch,title:t.title?t.title:t.name}}async startFetch(){(await(await fetch(`${this.baseUrl}/${this.typeMidiaFetch}/${this.category}?api_key=${this.apiKey}&page=1&language=pt-BR&region=BR`)).json()).results.forEach((i=>{const e=this.getDataMidia(i);new t(this.idSection,e).init()})),document.querySelectorAll(`${this.idSection} .movie-list li a`).forEach((t=>{new e(t,"#section-midia-similar").init()}))}init(){return this.startFetch(),this}}class s{constructor(t,i,e){this.element=t,this.events=i,this.callback=e,this.html=document.documentElement,this.outside="data-outside",this.handleOutsideClick=this.handleOutsideClick.bind(this)}handleOutsideClick({target:t}){this.element.contains(t)||(this.element.removeAttribute(this.outside),this.events.forEach((t=>{this.html.removeEventListener(t,this.handleOutsideClick)})),this.callback())}addEventsOutsideClick(){this.events.forEach((t=>{setTimeout((()=>{this.html.addEventListener(t,this.handleOutsideClick)})),this.element.setAttribute(this.outside,"")}))}init(){return this.element.hasAttribute(this.outside)||this.addEventsOutsideClick(),this}}const n="https://api.themoviedb.org/3",c="25ea17bf3ab54060fea05921b6061c3c",r="https://image.tmdb.org/t/p/w780";new a(n,c,r,"popular","#movie-popular","movie").init(),new a(n,c,r,"top_rated","#movie-top-rated","movie").init(),new a(n,c,r,"popular","#serie-popular","tv").init(),new a(n,c,r,"top_rated","#serie-top-rated","tv").init();const o=new class{constructor(t,i,e,a){this.baseUrl=t,this.imageUrl=e,this.apiKey=i,this.sectionLanding=document.querySelector(a),this.classItem="slide-container"}async buildLanding(){const t=+(3*Math.random()+1).toFixed(),i=await(await fetch(`${this.baseUrl}/movie/popular?api_key=${this.apiKey}&language=pt-BR&region=BR&page=${t}`)).json(),e=+(Math.random()*(i.results.length-1)).toFixed(),a=20*t+e,{vote_average:s,overview:n,release_date:c,backdrop_path:r,title:o}=i.results[e],d=document.createElement("li");d.classList.add(this.classItem),d.innerHTML=`\n      <div class="landing-content">\n              <div class="content-texts">\n              <p class="landing-info">#${a} Popular Movies</p>\n                <h1 class="landing-title">${o}\n                </h1>\n                <p class="landing-description">${n}</p>\n                <footer class="texts-footer">\n                  <p class="landing-date" data-landing="date">${c.slice(0,4)}</p>\n                  <div class="rate">\n                    ${s.toFixed(1)}\n                    <img src="./assets/icons/star.svg" alt="icon star rate" width="13px" height="13px">\n                  </div>\n                </footer>\n  \n              </div>\n              <div class="landing-button-container">\n                <a href="#" class="landing-button">\n                  watch now\n                  <img src="./assets/icons/play.svg" alt="icon play button" ">\n                  </a>\n                </div>\n              </div>\n              <div class="landing-image">\n                  <img src="${this.imageUrl}${r}" alt="poster of ${o}">\n              </div>\n    `,this.sectionLanding.appendChild(d)}init(){return this.buildLanding(),this}}(n,c,r,".landing-container .landing-list");o.init(),new class{constructor(t,i){this.btnMenu=document.querySelector(t),this.containerMenu=document.querySelector(i),this.events=["touchstart","click"],this.activeClass="active",this.openMenu=this.openMenu.bind(this)}openMenu(){this.btnMenu.classList.add(this.activeClass),this.containerMenu.classList.add(this.activeClass),new s(this.containerMenu,this.events,(()=>{this.btnMenu.classList.remove(this.activeClass),this.containerMenu.classList.remove(this.activeClass)})).init()}init(){this.btnMenu.addEventListener("click",this.openMenu)}}('[data-menu="button"]','[data-menu="container"]').init(),new class{constructor(t,i,e,a,s){this.containerSearch=document.querySelector(t),this.searchInput=document.querySelector(i),this.landingContainer=document.querySelector(e),this.mainContainerContent=document.querySelector(a),this.mainContainerSearch=document.querySelector(s),this.events=["touchstart","click"],this.activeClass="active",this.handleExpandSearch=this.handleExpandSearch.bind(this)}handleExpandSearch(){this.containerSearch.classList.add(this.activeClass),this.mainContainerSearch.classList.add(this.activeClass),this.mainContainerContent.classList.remove(this.activeClass),this.landingContainer.classList.remove(this.activeClass),new s(this.containerSearch,this.events,(()=>{this.containerSearch.classList.remove(this.activeClass),""===this.searchInput.value&&(this.mainContainerSearch.classList.remove(this.activeClass),this.landingContainer.classList.add(this.activeClass),this.mainContainerContent.classList.add(this.activeClass))})).init()}init(){return this.containerSearch.addEventListener("click",this.handleExpandSearch),this}}('[data-search="container"]','[data-search="container"] input',".landing-container","#main-content-container","#main-search-container").init();const d=new class{constructor(t,i,e,a,s,n){this.idSection=t,this.searchInput=document.querySelector(i),this.sectionTitle=document.querySelector(e),this.movieList=document.querySelector(a),this.baseUrl=s,this.apiKey=n,this.fetchSearch=function(t,i){let e;return(...i)=>{e&&clearTimeout(e),e=setTimeout((()=>{t(...i),e=null}),200)}}(this.fetchSearch.bind(this))}async fetchSearch(){const i=this.searchInput.value,e=await(await fetch(`${this.baseUrl}/search/movie?api_key=${this.apiKey}&language=en&region=BR&query=${i}&include_adult=false`)).json();if(this.movieList.children.length){const t=[...this.movieList.children];this.sectionTitle.innerText="Search by movies",t.forEach((t=>{this.movieList.removeChild(t)}))}e.results.forEach((i=>{if(i.backdrop_path){const e={rate:i.vote_average.toFixed(1),popularity:i.popularity,year:i.release_date.slice(0,4),backdrop:i.backdrop_path,image:i.poster_path,id:i.id,type:"movie",title:i.title};new t(this.idSection,e).init()}}))}addEventSearch(){this.searchInput.addEventListener("keyup",this.fetchSearch)}init(){return this.addEventSearch(),this}}("#main-search-container",'[data-search="container"] input',"#main-search-container .section-title","#main-search-container .movie-list",n,c);d.init()})();